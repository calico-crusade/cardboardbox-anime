<cba-container [loading]="loading" [error]="error" [handle-scroll]="true" flex-flow="column">
    <header>
        <div class="image" [style.background-image]="'url(' + proxy(manga?.cover) + ')'"></div>
        <div class="details">
            <div class="title">
                <a [href]="manga?.url" target="_blank">{{ manga?.title }}</a>
            </div>
            <div class="description" *ngIf="manga?.description">
                <div class="content" [markdown]="manga?.description"></div>
            </div>
        </div>
    </header>
    <header>
        <div class="details">
            <div class="tags">
                <div class="header">Tags: </div>
                <div class="tag" *ngFor="let tag of manga?.tags">{{ tag }}</div>
            </div>

            <div class="tags">
                <div class="header">Alt Titles: </div>
                <div class="tag secondary" *ngFor="let tag of manga?.altTitles">{{ tag }}</div>
            </div>
        </div>
    </header>
    <main>
        <a class="chapter resume" *ngIf="currentChapter" [routerLink]="[ '/manga', id, currentChapter.id, progress?.pageIndex ]">
            <div class="header">
                <div class="number">Resume Reading! </div>
                <div class="title">{{ currentChapter.title }}</div>
            </div>
            <div class="footer">
                <div class="lang">
                    <cba-icon>auto_stories</cba-icon> 
                    <span *ngIf="currentChapter.volume">Vol. {{ currentChapter.volume }}</span>
                    <span>Ch. {{ currentChapter.ordinal }}</span>
                    <span>Page. {{ progress?.pageIndex }}</span>
                </div>
                <div class="timings">
                    <cba-icon>schedule</cba-icon> 
                    <span>{{ progress?.updatedAt | date:'yyyy-MM-dd' }}</span>
                </div>
            </div>
        </a>
        <a class="chapter" *ngFor="let chapter of chapters" 
           [routerLink]="['/manga', id, chapter.id, 1]"
           [ngClass]="{ 'active': chapter.id === progress?.mangaChapterId }">
            <div class="header">
                <div class="number">
                    <span *ngIf="chapter.volume">Vol. {{ chapter.volume }}</span>
                    <span>Ch. {{ chapter.ordinal }}</span>
                </div>
                <div class="title">{{ chapter.title }}</div>
            </div>
            <div class="footer">
                <div class="lang">
                    <cba-icon>language</cba-icon> 
                    <span>{{ chapter.language }}</span>
                </div>
                <div class="timings">
                    <cba-icon>schedule</cba-icon> 
                    <span>{{ chapter.createdAt | date:'yyyy-MM-dd' }}</span>
                </div>
            </div>
        </a>
    </main>
    <div class="float-icons">
        <button class="float-icon" (click)="update()">
            <cba-icon>update</cba-icon>
        </button>
        <button class="float-icon" (click)="toggleFavourite()" *ngIf="loggedIn">
            <cba-icon [fill]="favourite">star</cba-icon>
        </button>
        <button class="float-icon" (click)="showBookmarks()" *ngIf="hasBookmarks">
            <cba-icon>bookmarks</cba-icon>
        </button>
    </div>
</cba-container>

<cba-popup #bookmarkspopup>
    <h2>Bookmarks</h2>
    <div class="bookmarks">
        <ng-container *ngFor="let bk of data?.bookmarks">
            <a *ngFor="let page of bk.pages" [routerLink]="['/manga', id, bk.mangaChapterId, page]">
                Ch. {{ getChapter(bk.mangaChapterId)?.ordinal }} - 
                {{ getChapter(bk.mangaChapterId)?.title }} 
                P. {{ page }}
            </a>
        </ng-container>
    </div>
</cba-popup>